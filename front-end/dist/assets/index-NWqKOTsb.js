(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const o of r)if(o.type==="childList")for(const i of o.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&n(i)}).observe(document,{childList:!0,subtree:!0});function a(r){const o={};return r.integrity&&(o.integrity=r.integrity),r.referrerPolicy&&(o.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?o.credentials="include":r.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(r){if(r.ep)return;r.ep=!0;const o=a(r);fetch(r.href,o)}})();function B(e,t,a){let n=Array.from(new Map(e.map(r=>[r[a],r])).values());n.sort((r,o)=>r[a].localeCompare(o[a]));for(const r of n){const o=document.createElement("option");o.id=r.id,o.value=r[a],o.textContent=r[a],t.appendChild(o)}}function R(e){return Number(e.trim().replace(/\./g,""))||0}function g(e){let t=e.value;t=t.replace(",",".");const a=parseFloat(t);isNaN(a)?e.value="":e.value=a.toFixed(2)}const q=window.location.hostname==="localhost"?"http://localhost:3000/api":"https://viveirolimeiragit.onrender.com/api";async function w(){try{const e=await fetch(`${q}/mudas`);if(!e.ok)throw new Error("Erro ao buscar mudas");return await e.json()}catch(e){return console.error("Erro ao buscar mudas:",e),[]}}let b=await w();b.sort((e,t)=>e.cultivar.localeCompare(t.cultivar));const D=window.location.hostname==="localhost"?"http://localhost:3000/api":"https://viveirolimeiragit.onrender.com/api";async function k(){try{const e=await fetch(`${D}/pedidos`);if(!e.ok)throw new Error("Erro ao buscar pedidos");return await e.json()}catch(e){return console.error("Erro ao buscar pedidos:",e),[]}}const P=window.location.hostname==="localhost"?"http://localhost:3000/api":"https://viveirolimeiragit.onrender.com/api";async function A(e,t,a,n,r,o,i,l,u,m,c){const d={id:e,idPedido:t,ano:a,cultivar:n,semente:r,embalagem:o,precoMuda:i,desconto:l,precoMudaDesconto:u,pedido:m,precoMudaTotal:c},p=await fetch(`${P}/carrinho`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(d)});try{if(!p.ok)throw alert("Erro de resposta"),new Error("Erro de resposta");p.ok?alert("Carrinho adicionado!!!!"):alert("Erro ao adicionar carrinho!!!!")}catch{alert("Erro ao adicionar carrinho, catch!!!!")}}async function O(){try{const e=await fetch(`${P}/carrinho`,{method:"DELETE"});if(!e.ok){const t=await e.json();alert("Erro ao excluir carrinho: "+t.message)}}catch(e){console.error(e),alert("Erro de conexão com o servidor.")}}let s={},C=[];const L=document.getElementById("index-produto-total"),$=document.getElementById("index-valor-total");function z(){document.getElementById("carrinho").style.right="0rem"}function H(){document.getElementById("carrinho").style.right="-40rem"}function U(){const e=document.getElementById("fechar-carrinho"),t=document.getElementById("abrir-carrinho");e.addEventListener("click",H),t.addEventListener("click",z)}function j(e){delete s[e];for(const t in s)T(t);Q()}function M(e){e||(s[e]="");let t=b.find(d=>d.id===e);delete t.estoque,delete t.producao,C.push(t);const a=document.getElementById("produtos-carrinho"),n=document.createElement("article");n.classList.add("cartao-produto-carrinho");const r=`
      <i id="remover-produto-${t.id}" class="fechar-produto-carrinho fa-solid fa-circle-xmark"></i>
      <div class="container-article-carrinho">
      <div class="cultivar-embalagem-carrinho">
        <p id="cultivar-${t.id}" class="cultivar-carrinho">${t.cultivar}</p>
        <p id="embalagem-${t.id}" class="embalagem-carrinho">${t.embalagem}</p>
      </div>

      <div class="valor-adicionar-carrinho">
      <div>
        <label for="valor-muda-${t.id}">R$_muda</label>
        <input type="text" id="valor-muda-${t.id}" class="input-produto-carrinho valor-muda" placeholder="R$ 0,00">
        </div>

      <div>
        <label for="desconto-muda-${t.id}">Desconto (%)</label>
        <input type="text" id="desconto-muda-${t.id}" class="input-produto-carrinho desconto-muda" placeholder="0,00">
      </div>

      <div>
        <label for="valor-muda-desconto-${t.id}">Desconto (R$_muda)</label>
        <input type="text" id="valor-muda-desconto-${t.id}" class="input-produto-carrinho valor-muda-desconto" placeholder="R$ 0,00">
        </div>

      </div>

      <div class="qtde-adicionar-carrinho">
          <div>
            <label for="quantidade-${t.id}">Qtde mudas</label>
            <input type="text" id="quantidade-${t.id}" class="input-produto-carrinho" placeholder="0.0">
          </div>

          <div>
            <label for="valor-total-${t.id}">R$ total</label>
            <input type="text" id="valor-total-${t.id}" class="input-produto-carrinho" placeholder="R$ 0,00">
          </div>

          <div>
            <button id="adicionar-${t.id}" class="adicionar-produto-carrinho">Adicionar</button>
          </div>

      </div>
      </div>`;n.innerHTML=r,a.appendChild(n),document.getElementById("index-finalizar-compra").classList.remove("hidden");let i=document.getElementById(`valor-muda-${t.id}`),l=document.getElementById(`desconto-muda-${t.id}`),u=document.getElementById(`valor-muda-desconto-${t.id}`),m=document.getElementById(`valor-total-${t.id}`),c=document.getElementById(`quantidade-${t.id}`);i.addEventListener("blur",()=>{if(g(i),g(l),l.value.length===0){if(u.value=i.value,c.value.length>0){let d=c.value.replace(/\D/g,"");d=Number(d),m.value=(Number(i.value)*d).toLocaleString("pt-BR")}return}if(l.value.length>0&&(u.value=(i.value*((100-l.value)/100)).toFixed(2),c.value.length>0)){let d=c.value.replace(/\D/g,"");d=Number(d),m.value=(Number(u.value)*d).toLocaleString("pt-BR")}}),l.addEventListener("blur",()=>{if(g(i),g(l),i.value.length>0&&(u.value=(i.value*((100-l.value)/100)).toFixed(2),c.value.length>0)){let d=c.value.replace(/\D/g,"");d=Number(d),m.value=(Number(u.value)*d).toLocaleString("pt-BR")}}),c.addEventListener("input",()=>{let d=c.value.replace(/\D/g,"");d=Number(d).toLocaleString("pt-BR"),c.value=d}),c.addEventListener("blur",()=>{let d=c.value.replace(/\D/g,"");d=Number(d),m.value=(Number(u.value)*d).toLocaleString("pt-BR")}),document.getElementById(`remover-produto-${t.id}`).addEventListener("click",()=>{j(t.id)}),document.getElementById(`quantidade-${t.id}`).addEventListener("input",d=>{s[e]=d.target.value;let p=C.find(I=>I.id===t.id);p&&(p.pedido=d.target.value)}),document.getElementById(`adicionar-${t.id}`).addEventListener("click",()=>{T(t.id)})}function Q(){const e=document.getElementById("produtos-carrinho");e.innerHTML="";for(const t in s)console.log("idProduto",t),M(t),document.getElementById(`quantidade-${t}`).value=s[t]}function V(e){e in s||(s[e]=0,M(e))}L.classList.add("hidden");$.classList.add("hidden");function T(e){s[e]=document.getElementById(`quantidade-${e}`).value.replace(".","");const t=parseFloat(document.getElementById(`valor-muda-${e}`).value),a=parseFloat(document.getElementById(`desconto-muda-${e}`).value),n=parseFloat(document.getElementById(`quantidade-${e}`).value);(isNaN(t)||isNaN(a)||isNaN(n)||t<0||a<0||n<0||t===0||a===0||n===0)&&alert("Por favor, digite corretamente a quantidade de mudas!!!");let r=[],o=[];for(const i in s){let l=Number(s[i]).toFixed(0);r.push(Number(l)),o.push(Number(Number(s[i]))*document.getElementById(`valor-muda-desconto-${i}`).value)}L.classList.remove("hidden"),L.innerText=`Mudas total: ${r.reduce((i,l)=>i+l,0).toLocaleString("pt-BR")}`,$.classList.remove("hidden"),$.innerText=`Valor total: R$ ${o.reduce((i,l)=>i+l,0).toLocaleString("pt-BR")}`}document.getElementById("index-finalizar-compra").addEventListener("click",async()=>{await O();let e={id:"",idPedido:"",ano:"",semente:"",embalagem:"",cultivar:"",precoMuda:"",desconto:"",precoMudaDesconto:"",pedido:"",precoMudaTotal:""},t=await b;for(const a in s){e={};let n=document.getElementById(`quantidade-${a}`).value,r=t.filter(o=>String(o.id)===String(a));e.id=r[0].id,e.idPedido=`${r[0].idmuda}-${n}`,e.ano=r[0].ano,e.cultivar=r[0].cultivar,e.semente=r[0].semente,e.embalagem=r[0].embalagem,e.cultivar=r[0].cultivar,e.precoMuda=document.getElementById(`valor-muda-${a}`).value,e.desconto=document.getElementById(`desconto-muda-${a}`).value,e.precoMudaDesconto=document.getElementById(`valor-muda-desconto-${a}`).value,e.pedido=document.getElementById(`quantidade-${a}`).value,e.precoMudaTotal=document.getElementById(`valor-total-${a}`).value,A(e.id,e.idPedido,e.ano,e.cultivar,e.semente,e.embalagem,e.precoMuda,e.desconto,e.precoMudaDesconto,e.pedido,e.precoMudaTotal)}window.location.href="checkout.html"});let v=await w()??[],_=await k()??[];v.sort((e,t)=>e.ano!==t.ano?e.ano.localeCompare(t.ano):e.cultivar!==t.cultivar?e.cultivar.localeCompare(t.cultivar):e.semente.localeCompare(t.semente));const h=document.getElementById("ano-select"),J=v.filter((e,t,a)=>t===a.findIndex(n=>n.ano===e.ano)),K=J.map((e,t)=>({id:t+1,ano:e.ano}));B(K,h,"ano");const f=document.getElementById("cultivar-select"),G=v.filter((e,t,a)=>t===a.findIndex(n=>n.cultivar===e.cultivar)),W=G.map((e,t)=>({id:t+1,cultivar:e.cultivar}));B(W,f,"cultivar");const E=document.getElementById("embalagem-select"),X=v.filter((e,t,a)=>t===a.findIndex(n=>n.embalagem===e.embalagem)),Y=X.map((e,t)=>({id:t+1,embalagem:e.embalagem}));B(Y,E,"embalagem");let x=document.getElementById("container-cultivares-select");function Z(){x.classList.remove("hidden"),document.getElementById("header-index").classList.add("hidden")}const ee=document.getElementById("icone-filtro");ee.addEventListener("click",Z);function te(){x.classList.add("hidden"),document.getElementById("header-index").classList.remove("hidden")}const oe=document.getElementById("icone-fechar-filtro");oe.addEventListener("click",te);let ae=[h,f,E];ae.forEach(e=>{e.addEventListener("change",re)});let S=document.getElementById("container-cartoes"),y=document.getElementById("container-novos-cartoes");async function re(){y.innerHTML="",S.remove(),y.classList.add("index-mudasbd"),console.log("selectFiltrarAno.value",h.value,"selectFiltrarCultivar",f.value,"selectFiltrarEmbalagem",E.value);let e=v;const t=h.value,a=f.value,n=E.value,r=e.filter(o=>(!t||o.ano===t)&&(!a||o.cultivar===a)&&(!n||o.embalagem===n));r.sort((o,i)=>o.ano!==i.ano?o.ano.localeCompare(i.ano):o.cultivar!==i.cultivar?o.cultivar.localeCompare(i.cultivar):o.semente.localeCompare(i.semente)),F(r,y)}function ne(e){const t=e.reduce((a,n)=>{const r=n.idmuda,o=R(n.pedido);return a[r]||(a[r]={idmuda:r,pedido:0}),a[r].pedido+=o,a},{});return Object.values(t)}let ie=ne(_);async function F(e,t){t.innerHTML="";let a=0,n=0,r=0;for(const o of await e){o.pedido=0;let i=ie.find(m=>Number(m.idmuda)===Number(o.id));o.pedido=i?i.pedido:0;let l=o.producao-o.pedido;const u=`
          <div class="card-produto" data-tipo=${o.embalagem.toLowerCase()}>
            <p class="cultivar">${o.cultivar}</p>

  <p class="embalagem">${o.embalagem}</p>
            <p class="producao">Produção: ${Number(o.producao).toLocaleString("pt-BR")}</p>
            <p class="pedido">Pedido: ${Number(o.pedido).toLocaleString("pt-BR")} </p>
            <p class="estoque">Estoque: ${Number(l).toLocaleString("pt-BR")} </p>
            <button id="adicionar-${o.id}" ><i class="fa-solid fa-cart-plus"></i></button>
          </div>`;t.innerHTML+=u,a+=Number(o.producao),n+=Number(o.pedido),r+=l}document.getElementById("container-produto-soma").innerHTML=`PRODUÇÃO:
        ${Number(a).toLocaleString("pt-BR")}`,document.getElementById("container-produto-pedido").innerHTML=`PEDIDO:
        ${Number(n).toLocaleString("pt-BR")}`,document.getElementById("container-produto-estoque").innerHTML=`ESTOQUE:
        ${Number(r).toLocaleString("pt-BR")}`;for(const o of e)document.getElementById(`adicionar-${o.id}`).addEventListener("click",()=>{V(o.id)})}F(b,S);U();document.addEventListener("DOMContentLoaded",()=>{document.body.addEventListener("click",async e=>{if(e.target.closest("a[data-link]")){e.preventDefault();const a=e.target.closest("a").getAttribute("href");history.pushState({},"",a),await N(a)}}),N(location.pathname)});async function N(e){const t=document.querySelector("main");let a="";switch(e){case"/mudas":a="./src/pages/mudas.html";break;case"/entregas":a="./src/pages/entregas.html";break;case"/pedidos":a="./src/pages/pedidos.html";break;case"/clientes":a="./src/pages/clientes.html";break;default:a="./src/pages/mudas.html"}const r=await(await fetch(a)).text();t.innerHTML=r}
