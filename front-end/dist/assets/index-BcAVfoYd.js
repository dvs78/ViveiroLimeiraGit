(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))n(a);new MutationObserver(a=>{for(const o of a)if(o.type==="childList")for(const i of o.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&n(i)}).observe(document,{childList:!0,subtree:!0});function r(a){const o={};return a.integrity&&(o.integrity=a.integrity),a.referrerPolicy&&(o.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?o.credentials="include":a.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(a){if(a.ep)return;a.ep=!0;const o=r(a);fetch(a.href,o)}})();function L(e,t,r){let n=Array.from(new Map(e.map(a=>[a[r],a])).values());n.sort((a,o)=>a[r].localeCompare(o[r]));for(const a of n){const o=document.createElement("option");o.id=a.id,o.value=a[r],o.textContent=a[r],t.appendChild(o)}}function w(e){return Number(e.trim().replace(/\./g,""))||0}function g(e){let t=e.value;t=t.replace(",",".");const r=parseFloat(t);isNaN(r)?e.value="":e.value=r.toFixed(2)}const R="http://localhost:3000/api";async function N(){try{const e=await fetch(`${R}/mudas`);if(!e.ok)throw new Error("Erro ao buscar mudas");return await e.json()}catch(e){return console.error("Erro ao buscar mudas:",e),[]}}let b=await N();b.sort((e,t)=>e.cultivar.localeCompare(t.cultivar));const q="http://localhost:3000/api";async function D(){try{const e=await fetch(`${q}/pedidos`);if(!e.ok)throw new Error("Erro ao buscar pedidos");return await e.json()}catch(e){return console.error("Erro ao buscar pedidos:",e),[]}}const P="http://localhost:3000/api";async function A(e,t,r,n,a,o,i,l,s,m,c){const d={id:e,idPedido:t,ano:r,cultivar:n,semente:a,embalagem:o,precoMuda:i,desconto:l,precoMudaDesconto:s,pedido:m,precoMudaTotal:c},p=await fetch(`${P}/carrinho`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(d)});try{if(!p.ok)throw alert("Erro de resposta"),new Error("Erro de resposta");p.ok?alert("Carrinho adicionado!!!!"):alert("Erro ao adicionar carrinho!!!!")}catch{alert("Erro ao adicionar carrinho, catch!!!!")}}async function O(){try{const e=await fetch(`${P}/carrinho`,{method:"DELETE"});if(!e.ok){const t=await e.json();alert("Erro ao excluir carrinho: "+t.message)}}catch(e){console.error(e),alert("Erro de conexão com o servidor.")}}let u={},C=[];const $=document.getElementById("index-produto-total"),B=document.getElementById("index-valor-total");function k(){document.getElementById("carrinho").style.right="0rem"}function z(){document.getElementById("carrinho").style.right="-40rem"}function H(){const e=document.getElementById("fechar-carrinho"),t=document.getElementById("abrir-carrinho");e.addEventListener("click",z),t.addEventListener("click",k)}function U(e){delete u[e];for(const t in u)T(t);j()}function M(e){e||(u[e]="");let t=b.find(d=>d.id===e);delete t.estoque,delete t.producao,C.push(t);const r=document.getElementById("produtos-carrinho"),n=document.createElement("article");n.classList.add("cartao-produto-carrinho");const a=`
      <i id="remover-produto-${t.id}" class="fechar-produto-carrinho fa-solid fa-circle-xmark"></i>
      <div class="container-article-carrinho">
      <div class="cultivar-embalagem-carrinho">
        <p id="cultivar-${t.id}" class="cultivar-carrinho">${t.cultivar}</p>
        <p id="embalagem-${t.id}" class="embalagem-carrinho">${t.embalagem}</p>
      </div>

      <div class="valor-adicionar-carrinho">
      <div>
        <label for="valor-muda-${t.id}">R$_muda</label>
        <input type="text" id="valor-muda-${t.id}" class="input-produto-carrinho valor-muda" placeholder="R$ 0,00">
        </div>

      <div>
        <label for="desconto-muda-${t.id}">Desconto (%)</label>
        <input type="text" id="desconto-muda-${t.id}" class="input-produto-carrinho desconto-muda" placeholder="0,00">
      </div>

      <div>
        <label for="valor-muda-desconto-${t.id}">Desconto (R$_muda)</label>
        <input type="text" id="valor-muda-desconto-${t.id}" class="input-produto-carrinho valor-muda-desconto" placeholder="R$ 0,00">
        </div>

      </div>

      <div class="qtde-adicionar-carrinho">
          <div>
            <label for="quantidade-${t.id}">Qtde mudas</label>
            <input type="text" id="quantidade-${t.id}" class="input-produto-carrinho" placeholder="0.0">
          </div>

          <div>
            <label for="valor-total-${t.id}">R$ total</label>
            <input type="text" id="valor-total-${t.id}" class="input-produto-carrinho" placeholder="R$ 0,00">
          </div>

          <div>
            <button id="adicionar-${t.id}" class="adicionar-produto-carrinho">Adicionar</button>
          </div>

      </div>
      </div>`;n.innerHTML=a,r.appendChild(n),document.getElementById("index-finalizar-compra").classList.remove("hidden");let i=document.getElementById(`valor-muda-${t.id}`),l=document.getElementById(`desconto-muda-${t.id}`),s=document.getElementById(`valor-muda-desconto-${t.id}`),m=document.getElementById(`valor-total-${t.id}`),c=document.getElementById(`quantidade-${t.id}`);i.addEventListener("blur",()=>{if(g(i),g(l),l.value.length===0){if(s.value=i.value,c.value.length>0){let d=c.value.replace(/\D/g,"");d=Number(d),m.value=(Number(i.value)*d).toLocaleString("pt-BR")}return}if(l.value.length>0&&(s.value=(i.value*((100-l.value)/100)).toFixed(2),c.value.length>0)){let d=c.value.replace(/\D/g,"");d=Number(d),m.value=(Number(s.value)*d).toLocaleString("pt-BR")}}),l.addEventListener("blur",()=>{if(g(i),g(l),i.value.length>0&&(s.value=(i.value*((100-l.value)/100)).toFixed(2),c.value.length>0)){let d=c.value.replace(/\D/g,"");d=Number(d),m.value=(Number(s.value)*d).toLocaleString("pt-BR")}}),c.addEventListener("input",()=>{let d=c.value.replace(/\D/g,"");d=Number(d).toLocaleString("pt-BR"),c.value=d}),c.addEventListener("blur",()=>{let d=c.value.replace(/\D/g,"");d=Number(d),m.value=(Number(s.value)*d).toLocaleString("pt-BR")}),document.getElementById(`remover-produto-${t.id}`).addEventListener("click",()=>{U(t.id)}),document.getElementById(`quantidade-${t.id}`).addEventListener("input",d=>{u[e]=d.target.value;let p=C.find(I=>I.id===t.id);p&&(p.pedido=d.target.value)}),document.getElementById(`adicionar-${t.id}`).addEventListener("click",()=>{T(t.id)})}function j(){const e=document.getElementById("produtos-carrinho");e.innerHTML="";for(const t in u)console.log("idProduto",t),M(t),document.getElementById(`quantidade-${t}`).value=u[t]}function Q(e){e in u||(u[e]=0,M(e))}$.classList.add("hidden");B.classList.add("hidden");function T(e){u[e]=document.getElementById(`quantidade-${e}`).value.replace(".","");const t=parseFloat(document.getElementById(`valor-muda-${e}`).value),r=parseFloat(document.getElementById(`desconto-muda-${e}`).value),n=parseFloat(document.getElementById(`quantidade-${e}`).value);(isNaN(t)||isNaN(r)||isNaN(n)||t<0||r<0||n<0||t===0||r===0||n===0)&&alert("Por favor, digite corretamente a quantidade de mudas!!!");let a=[],o=[];for(const i in u){let l=Number(u[i]).toFixed(0);a.push(Number(l)),o.push(Number(Number(u[i]))*document.getElementById(`valor-muda-desconto-${i}`).value)}$.classList.remove("hidden"),$.innerText=`Mudas total: ${a.reduce((i,l)=>i+l,0).toLocaleString("pt-BR")}`,B.classList.remove("hidden"),B.innerText=`Valor total: R$ ${o.reduce((i,l)=>i+l,0).toLocaleString("pt-BR")}`}document.getElementById("index-finalizar-compra").addEventListener("click",async()=>{await O();let e={id:"",idPedido:"",ano:"",semente:"",embalagem:"",cultivar:"",precoMuda:"",desconto:"",precoMudaDesconto:"",pedido:"",precoMudaTotal:""},t=await b;for(const r in u){e={};let n=document.getElementById(`quantidade-${r}`).value,a=t.filter(o=>String(o.id)===String(r));e.id=a[0].id,e.idPedido=`${a[0].idmuda}-${n}`,e.ano=a[0].ano,e.cultivar=a[0].cultivar,e.semente=a[0].semente,e.embalagem=a[0].embalagem,e.cultivar=a[0].cultivar,e.precoMuda=document.getElementById(`valor-muda-${r}`).value,e.desconto=document.getElementById(`desconto-muda-${r}`).value,e.precoMudaDesconto=document.getElementById(`valor-muda-desconto-${r}`).value,e.pedido=document.getElementById(`quantidade-${r}`).value,e.precoMudaTotal=document.getElementById(`valor-total-${r}`).value,A(e.id,e.idPedido,e.ano,e.cultivar,e.semente,e.embalagem,e.precoMuda,e.desconto,e.precoMudaDesconto,e.pedido,e.precoMudaTotal)}window.location.href="checkout.html"});let v=await N()??[],V=await D()??[];v.sort((e,t)=>e.ano!==t.ano?e.ano.localeCompare(t.ano):e.cultivar!==t.cultivar?e.cultivar.localeCompare(t.cultivar):e.semente.localeCompare(t.semente));const f=document.getElementById("ano-select"),_=v.filter((e,t,r)=>t===r.findIndex(n=>n.ano===e.ano)),J=_.map((e,t)=>({id:t+1,ano:e.ano}));L(J,f,"ano");const h=document.getElementById("cultivar-select"),K=v.filter((e,t,r)=>t===r.findIndex(n=>n.cultivar===e.cultivar)),G=K.map((e,t)=>({id:t+1,cultivar:e.cultivar}));L(G,h,"cultivar");const E=document.getElementById("embalagem-select"),W=v.filter((e,t,r)=>t===r.findIndex(n=>n.embalagem===e.embalagem)),X=W.map((e,t)=>({id:t+1,embalagem:e.embalagem}));L(X,E,"embalagem");let x=document.getElementById("container-cultivares-select");function Y(){x.classList.remove("hidden"),document.getElementById("header-index").classList.add("hidden")}const Z=document.getElementById("icone-filtro");Z.addEventListener("click",Y);function ee(){x.classList.add("hidden"),document.getElementById("header-index").classList.remove("hidden")}const te=document.getElementById("icone-fechar-filtro");te.addEventListener("click",ee);let oe=[f,h,E];oe.forEach(e=>{e.addEventListener("change",ae)});let F=document.getElementById("container-cartoes"),y=document.getElementById("container-novos-cartoes");async function ae(){y.innerHTML="",F.remove(),y.classList.add("index-mudasbd"),console.log("selectFiltrarAno.value",f.value,"selectFiltrarCultivar",h.value,"selectFiltrarEmbalagem",E.value);let e=v;const t=f.value,r=h.value,n=E.value,a=e.filter(o=>(!t||o.ano===t)&&(!r||o.cultivar===r)&&(!n||o.embalagem===n));a.sort((o,i)=>o.ano!==i.ano?o.ano.localeCompare(i.ano):o.cultivar!==i.cultivar?o.cultivar.localeCompare(i.cultivar):o.semente.localeCompare(i.semente)),S(a,y)}function re(e){const t=e.reduce((r,n)=>{const a=n.idmuda,o=w(n.pedido);return r[a]||(r[a]={idmuda:a,pedido:0}),r[a].pedido+=o,r},{});return Object.values(t)}let ne=re(V);async function S(e,t){t.innerHTML="";let r=0,n=0,a=0;for(const o of await e){o.pedido=0;let i=ne.find(m=>Number(m.idmuda)===Number(o.id));o.pedido=i?i.pedido:0;let l=o.producao-o.pedido;const s=`
          <div class="card-produto" data-tipo=${o.embalagem.toLowerCase()}>
            <p class="cultivar">${o.cultivar}</p>

  <p class="embalagem">${o.embalagem}</p>
            <p class="producao">Produção: ${Number(o.producao).toLocaleString("pt-BR")}</p>
            <p class="pedido">Pedido: ${Number(o.pedido).toLocaleString("pt-BR")} </p>
            <p class="estoque">Estoque: ${Number(l).toLocaleString("pt-BR")} </p>
            <button id="adicionar-${o.id}" ><i class="fa-solid fa-cart-plus"></i></button>
          </div>`;t.innerHTML+=s,r+=Number(o.producao),n+=Number(o.pedido),a+=l}document.getElementById("container-produto-soma").innerHTML=`PRODUÇÃO:
        ${Number(r).toLocaleString("pt-BR")}`,document.getElementById("container-produto-pedido").innerHTML=`PEDIDO:
        ${Number(n).toLocaleString("pt-BR")}`,document.getElementById("container-produto-estoque").innerHTML=`ESTOQUE:
        ${Number(a).toLocaleString("pt-BR")}`;for(const o of e)document.getElementById(`adicionar-${o.id}`).addEventListener("click",()=>{Q(o.id)})}S(b,F);H();
