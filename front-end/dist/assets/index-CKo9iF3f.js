(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))i(a);new MutationObserver(a=>{for(const o of a)if(o.type==="childList")for(const l of o.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&i(l)}).observe(document,{childList:!0,subtree:!0});function n(a){const o={};return a.integrity&&(o.integrity=a.integrity),a.referrerPolicy&&(o.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?o.credentials="include":a.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function i(a){if(a.ep)return;a.ep=!0;const o=n(a);fetch(a.href,o)}})();function q(e,t,n){let i=Array.from(new Map(e.map(a=>[a[n],a])).values());i.sort((a,o)=>a[n].localeCompare(o[n]));for(const a of i){const o=document.createElement("option");o.id=a.id,o.value=a[n],o.textContent=a[n],t.appendChild(o)}}function le(e){return Number(e.trim().replace(/\./g,""))||0}function T(e){let t=e.value;t=t.replace(",",".");const n=parseFloat(t);isNaN(n)?e.value="":e.value=n.toFixed(2)}function V(e){if(Object.prototype.hasOwnProperty.call(e,"__esModule"))return e;var t=e.default;if(typeof t=="function"){var n=function i(){return this instanceof i?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};n.prototype=t.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(e).forEach(function(i){var a=Object.getOwnPropertyDescriptor(e,i);Object.defineProperty(n,i,a.get?a:{enumerable:!0,get:function(){return e[i]}})}),n}var K={},$={exports:{}};const ce=new Proxy({},{get(e,t){throw new Error(`Module "" has been externalized for browser compatibility. Cannot access ".${t}" in client code.  See https://vite.dev/guide/troubleshooting.html#module-externalized-for-browser-compatibility for more details.`)}}),de=Object.freeze(Object.defineProperty({__proto__:null,default:ce},Symbol.toStringTag,{value:"Module"})),se=V(de),ue=new Proxy({},{get(e,t){throw new Error(`Module "path" has been externalized for browser compatibility. Cannot access "path.${t}" in client code.  See https://vite.dev/guide/troubleshooting.html#module-externalized-for-browser-compatibility for more details.`)}}),me=Object.freeze(Object.defineProperty({__proto__:null,default:ue},Symbol.toStringTag,{value:"Module"})),pe=V(me),fe=new Proxy({},{get(e,t){throw new Error(`Module "os" has been externalized for browser compatibility. Cannot access "os.${t}" in client code.  See https://vite.dev/guide/troubleshooting.html#module-externalized-for-browser-compatibility for more details.`)}}),ve=Object.freeze(Object.defineProperty({__proto__:null,default:fe},Symbol.toStringTag,{value:"Module"})),ge=V(ve),he=new Proxy({},{get(e,t){throw new Error(`Module "crypto" has been externalized for browser compatibility. Cannot access "crypto.${t}" in client code.  See https://vite.dev/guide/troubleshooting.html#module-externalized-for-browser-compatibility for more details.`)}}),Ee=Object.freeze(Object.defineProperty({__proto__:null,default:he},Symbol.toStringTag,{value:"Module"})),ye=V(Ee),_e="16.5.0",be={version:_e};var Y;function Ne(){if(Y)return $.exports;Y=1;var e={};const t=se,n=pe,i=ge,a=ye,l=be.version,f=/(?:^|^)\s*(?:export\s+)?([\w.-]+)(?:\s*=\s*?|:\s+?)(\s*'(?:\\'|[^'])*'|\s*"(?:\\"|[^"])*"|\s*`(?:\\`|[^`])*`|[^#\r\n]+)?\s*(?:#.*)?(?:$|$)/mg;function _(r){const u={};let s=r.toString();s=s.replace(/\r\n?/mg,`
`);let p;for(;(p=f.exec(s))!=null;){const h=p[1];let c=p[2]||"";c=c.trim();const m=c[0];c=c.replace(/^(['"`])([\s\S]*)\1$/mg,"$2"),m==='"'&&(c=c.replace(/\\n/g,`
`),c=c.replace(/\\r/g,"\r")),u[h]=c}return u}function N(r){const u=k(r),s=g.configDotenv({path:u});if(!s.parsed){const m=new Error(`MISSING_DATA: Cannot parse ${u} for an unknown reason`);throw m.code="MISSING_DATA",m}const p=O(r).split(","),h=p.length;let c;for(let m=0;m<h;m++)try{const v=p[m].trim(),b=B(s,v);c=g.decrypt(b.ciphertext,b.key);break}catch(v){if(m+1>=h)throw v}return g.parse(c)}function E(r){console.log(`[dotenv@${l}][WARN] ${r}`)}function d(r){console.log(`[dotenv@${l}][DEBUG] ${r}`)}function O(r){return r&&r.DOTENV_KEY&&r.DOTENV_KEY.length>0?r.DOTENV_KEY:e.DOTENV_KEY&&e.DOTENV_KEY.length>0?e.DOTENV_KEY:""}function B(r,u){let s;try{s=new URL(u)}catch(v){if(v.code==="ERR_INVALID_URL"){const b=new Error("INVALID_DOTENV_KEY: Wrong format. Must be in valid uri format like dotenv://:key_1234@dotenvx.com/vault/.env.vault?environment=development");throw b.code="INVALID_DOTENV_KEY",b}throw v}const p=s.password;if(!p){const v=new Error("INVALID_DOTENV_KEY: Missing key part");throw v.code="INVALID_DOTENV_KEY",v}const h=s.searchParams.get("environment");if(!h){const v=new Error("INVALID_DOTENV_KEY: Missing environment part");throw v.code="INVALID_DOTENV_KEY",v}const c=`DOTENV_VAULT_${h.toUpperCase()}`,m=r.parsed[c];if(!m){const v=new Error(`NOT_FOUND_DOTENV_ENVIRONMENT: Cannot locate environment ${c} in your .env.vault file.`);throw v.code="NOT_FOUND_DOTENV_ENVIRONMENT",v}return{ciphertext:m,key:p}}function k(r){let u=null;if(r&&r.path&&r.path.length>0)if(Array.isArray(r.path))for(const s of r.path)t.existsSync(s)&&(u=s.endsWith(".vault")?s:`${s}.vault`);else u=r.path.endsWith(".vault")?r.path:`${r.path}.vault`;else u=n.resolve(process.cwd(),".env.vault");return t.existsSync(u)?u:null}function j(r){return r[0]==="~"?n.join(i.homedir(),r.slice(1)):r}function re(r){!!(r&&r.debug)&&d("Loading env from encrypted .env.vault");const s=g._parseVault(r);let p=e;return r&&r.processEnv!=null&&(p=r.processEnv),g.populate(p,s,r),{parsed:s}}function oe(r){const u=n.resolve(process.cwd(),".env");let s="utf8";const p=!!(r&&r.debug);r&&r.encoding?s=r.encoding:p&&d("No encoding is specified. UTF-8 is used by default");let h=[u];if(r&&r.path)if(!Array.isArray(r.path))h=[j(r.path)];else{h=[];for(const b of r.path)h.push(j(b))}let c;const m={};for(const b of h)try{const I=g.parse(t.readFileSync(b,{encoding:s}));g.populate(m,I,r)}catch(I){p&&d(`Failed to load ${b} ${I.message}`),c=I}let v=e;return r&&r.processEnv!=null&&(v=r.processEnv),g.populate(v,m,r),c?{parsed:m,error:c}:{parsed:m}}function ae(r){if(O(r).length===0)return g.configDotenv(r);const u=k(r);return u?g._configVault(r):(E(`You set DOTENV_KEY but you are missing a .env.vault file at ${u}. Did you forget to build it?`),g.configDotenv(r))}function ne(r,u){const s=Buffer.from(u.slice(-64),"hex");let p=Buffer.from(r,"base64");const h=p.subarray(0,12),c=p.subarray(-16);p=p.subarray(12,-16);try{const m=a.createDecipheriv("aes-256-gcm",s,h);return m.setAuthTag(c),`${m.update(p)}${m.final()}`}catch(m){const v=m instanceof RangeError,b=m.message==="Invalid key length",I=m.message==="Unsupported state or unable to authenticate data";if(v||b){const D=new Error("INVALID_DOTENV_KEY: It must be 64 characters long (or more)");throw D.code="INVALID_DOTENV_KEY",D}else if(I){const D=new Error("DECRYPTION_FAILED: Please check your DOTENV_KEY");throw D.code="DECRYPTION_FAILED",D}else throw m}}function ie(r,u,s={}){const p=!!(s&&s.debug),h=!!(s&&s.override);if(typeof u!="object"){const c=new Error("OBJECT_REQUIRED: Please check the processEnv argument being passed to populate");throw c.code="OBJECT_REQUIRED",c}for(const c of Object.keys(u))Object.prototype.hasOwnProperty.call(r,c)?(h===!0&&(r[c]=u[c]),p&&d(h===!0?`"${c}" is already defined and WAS overwritten`:`"${c}" is already defined and was NOT overwritten`)):r[c]=u[c]}const g={configDotenv:oe,_configVault:re,_parseVault:N,config:ae,decrypt:ne,parse:_,populate:ie};return $.exports.configDotenv=g.configDotenv,$.exports._configVault=g._configVault,$.exports._parseVault=g._parseVault,$.exports.config=g.config,$.exports.decrypt=g.decrypt,$.exports.parse=g.parse,$.exports.populate=g.populate,$.exports=g,$.exports}var M,z;function $e(){if(z)return M;z=1;var e={};const t={};return e.DOTENV_CONFIG_ENCODING!=null&&(t.encoding=e.DOTENV_CONFIG_ENCODING),e.DOTENV_CONFIG_PATH!=null&&(t.path=e.DOTENV_CONFIG_PATH),e.DOTENV_CONFIG_DEBUG!=null&&(t.debug=e.DOTENV_CONFIG_DEBUG),e.DOTENV_CONFIG_OVERRIDE!=null&&(t.override=e.DOTENV_CONFIG_OVERRIDE),e.DOTENV_CONFIG_DOTENV_KEY!=null&&(t.DOTENV_KEY=e.DOTENV_CONFIG_DOTENV_KEY),M=t,M}var R,U;function Oe(){if(U)return R;U=1;const e=/^dotenv_config_(encoding|path|debug|override|DOTENV_KEY)=(.+)$/;return R=function(n){return n.reduce(function(i,a){const o=a.match(e);return o&&(i[o[1]]=o[2]),i},{})},R}var G;function Ie(){return G||(G=1,function(){Ne().config(Object.assign({},$e(),Oe()(process.argv)))}()),K}Ie();var De={};const{NODE_ENV:we}=De,Be=we==="development"?"http://localhost:3000/api":"/api";async function Q(){try{const e=await fetch(`${Be}/mudas`);if(!e.ok)throw new Error("Erro ao buscar mudas");return await e.json()}catch(e){return console.error("Erro ao buscar mudas:",e),[]}}let P=await Q();P.sort((e,t)=>e.cultivar.localeCompare(t.cultivar));var Te={};const{NODE_ENV:Le}=Te,Ce=Le==="development"?"http://localhost:3000/api":"/api";async function xe(){try{const e=await fetch(`${Ce}/pedidos`);if(!e.ok)throw new Error("Erro ao buscar pedidos");return await e.json()}catch(e){return console.error("Erro ao buscar pedidos:",e),[]}}var Ve={};const{NODE_ENV:Pe}=Ve,J=Pe==="development"?"http://localhost:3000/api":"/api";async function Me(e,t,n,i,a,o,l,f,_,N,E){const d={id:e,idPedido:t,ano:n,cultivar:i,semente:a,embalagem:o,precoMuda:l,desconto:f,precoMudaDesconto:_,pedido:N,precoMudaTotal:E},O=await fetch(`${J}/carrinho`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(d)});try{if(!O.ok)throw alert("Erro de resposta"),new Error("Erro de resposta");O.ok?alert("Carrinho adicionado!!!!"):alert("Erro ao adicionar carrinho!!!!")}catch{alert("Erro ao adicionar carrinho, catch!!!!")}}async function Re(){try{const e=await fetch(`${J}/carrinho`,{method:"DELETE"});if(!e.ok){const t=await e.json();alert("Erro ao excluir carrinho: "+t.message)}}catch(e){console.error(e),alert("Erro de conexão com o servidor.")}}let y={},H=[];const F=document.getElementById("index-produto-total"),A=document.getElementById("index-valor-total");function Se(){document.getElementById("carrinho").style.right="0rem"}function Fe(){document.getElementById("carrinho").style.right="-40rem"}function Ae(){const e=document.getElementById("fechar-carrinho"),t=document.getElementById("abrir-carrinho");e.addEventListener("click",Fe),t.addEventListener("click",Se)}function qe(e){delete y[e];for(const t in y)X(t);ke()}function W(e){e||(y[e]="");let t=P.find(d=>d.id===e);delete t.estoque,delete t.producao,H.push(t);const n=document.getElementById("produtos-carrinho"),i=document.createElement("article");i.classList.add("cartao-produto-carrinho");const a=`
      <i id="remover-produto-${t.id}" class="fechar-produto-carrinho fa-solid fa-circle-xmark"></i>
      <div class="container-article-carrinho">
      <div class="cultivar-embalagem-carrinho">
        <p id="cultivar-${t.id}" class="cultivar-carrinho">${t.cultivar}</p>
        <p id="embalagem-${t.id}" class="embalagem-carrinho">${t.embalagem}</p>
      </div>

      <div class="valor-adicionar-carrinho">
      <div>
        <label for="valor-muda-${t.id}">R$_muda</label>
        <input type="text" id="valor-muda-${t.id}" class="input-produto-carrinho valor-muda" placeholder="R$ 0,00">
        </div>

      <div>
        <label for="desconto-muda-${t.id}">Desconto (%)</label>
        <input type="text" id="desconto-muda-${t.id}" class="input-produto-carrinho desconto-muda" placeholder="0,00">
      </div>

      <div>
        <label for="valor-muda-desconto-${t.id}">Desconto (R$_muda)</label>
        <input type="text" id="valor-muda-desconto-${t.id}" class="input-produto-carrinho valor-muda-desconto" placeholder="R$ 0,00">
        </div>

      </div>

      <div class="qtde-adicionar-carrinho">
          <div>
            <label for="quantidade-${t.id}">Qtde mudas</label>
            <input type="text" id="quantidade-${t.id}" class="input-produto-carrinho" placeholder="0.0">
          </div>

          <div>
            <label for="valor-total-${t.id}">R$ total</label>
            <input type="text" id="valor-total-${t.id}" class="input-produto-carrinho" placeholder="R$ 0,00">
          </div>

          <div>
            <button id="adicionar-${t.id}" class="adicionar-produto-carrinho">Adicionar</button>
          </div>

      </div>
      </div>`;i.innerHTML=a,n.appendChild(i),document.getElementById("index-finalizar-compra").classList.remove("hidden");let l=document.getElementById(`valor-muda-${t.id}`),f=document.getElementById(`desconto-muda-${t.id}`),_=document.getElementById(`valor-muda-desconto-${t.id}`),N=document.getElementById(`valor-total-${t.id}`),E=document.getElementById(`quantidade-${t.id}`);l.addEventListener("blur",()=>{if(T(l),T(f),f.value.length===0){if(_.value=l.value,E.value.length>0){let d=E.value.replace(/\D/g,"");d=Number(d),N.value=(Number(l.value)*d).toLocaleString("pt-BR")}return}if(f.value.length>0&&(_.value=(l.value*((100-f.value)/100)).toFixed(2),E.value.length>0)){let d=E.value.replace(/\D/g,"");d=Number(d),N.value=(Number(_.value)*d).toLocaleString("pt-BR")}}),f.addEventListener("blur",()=>{if(T(l),T(f),l.value.length>0&&(_.value=(l.value*((100-f.value)/100)).toFixed(2),E.value.length>0)){let d=E.value.replace(/\D/g,"");d=Number(d),N.value=(Number(_.value)*d).toLocaleString("pt-BR")}}),E.addEventListener("input",()=>{let d=E.value.replace(/\D/g,"");d=Number(d).toLocaleString("pt-BR"),E.value=d}),E.addEventListener("blur",()=>{let d=E.value.replace(/\D/g,"");d=Number(d),N.value=(Number(_.value)*d).toLocaleString("pt-BR")}),document.getElementById(`remover-produto-${t.id}`).addEventListener("click",()=>{qe(t.id)}),document.getElementById(`quantidade-${t.id}`).addEventListener("input",d=>{y[e]=d.target.value;let O=H.find(B=>B.id===t.id);O&&(O.pedido=d.target.value)}),document.getElementById(`adicionar-${t.id}`).addEventListener("click",()=>{X(t.id)})}function ke(){const e=document.getElementById("produtos-carrinho");e.innerHTML="";for(const t in y)console.log("idProduto",t),W(t),document.getElementById(`quantidade-${t}`).value=y[t]}function je(e){e in y||(y[e]=0,W(e))}F.classList.add("hidden");A.classList.add("hidden");function X(e){y[e]=document.getElementById(`quantidade-${e}`).value.replace(".","");const t=parseFloat(document.getElementById(`valor-muda-${e}`).value),n=parseFloat(document.getElementById(`desconto-muda-${e}`).value),i=parseFloat(document.getElementById(`quantidade-${e}`).value);(isNaN(t)||isNaN(n)||isNaN(i)||t<0||n<0||i<0||t===0||n===0||i===0)&&alert("Por favor, digite corretamente a quantidade de mudas!!!");let a=[],o=[];for(const l in y){let f=Number(y[l]).toFixed(0);a.push(Number(f)),o.push(Number(Number(y[l]))*document.getElementById(`valor-muda-desconto-${l}`).value)}F.classList.remove("hidden"),F.innerText=`Mudas total: ${a.reduce((l,f)=>l+f,0).toLocaleString("pt-BR")}`,A.classList.remove("hidden"),A.innerText=`Valor total: R$ ${o.reduce((l,f)=>l+f,0).toLocaleString("pt-BR")}`}document.getElementById("index-finalizar-compra").addEventListener("click",async()=>{await Re();let e={id:"",idPedido:"",ano:"",semente:"",embalagem:"",cultivar:"",precoMuda:"",desconto:"",precoMudaDesconto:"",pedido:"",precoMudaTotal:""},t=await P;for(const n in y){e={};let i=document.getElementById(`quantidade-${n}`).value,a=t.filter(o=>String(o.id)===String(n));e.id=a[0].id,e.idPedido=`${a[0].idmuda}-${i}`,e.ano=a[0].ano,e.cultivar=a[0].cultivar,e.semente=a[0].semente,e.embalagem=a[0].embalagem,e.cultivar=a[0].cultivar,e.precoMuda=document.getElementById(`valor-muda-${n}`).value,e.desconto=document.getElementById(`desconto-muda-${n}`).value,e.precoMudaDesconto=document.getElementById(`valor-muda-desconto-${n}`).value,e.pedido=document.getElementById(`quantidade-${n}`).value,e.precoMudaTotal=document.getElementById(`valor-total-${n}`).value,Me(e.id,e.idPedido,e.ano,e.cultivar,e.semente,e.embalagem,e.precoMuda,e.desconto,e.precoMudaDesconto,e.pedido,e.precoMudaTotal)}window.location.href="checkout.html"});let w=await Q()??[],Ke=await xe()??[];w.sort((e,t)=>e.ano!==t.ano?e.ano.localeCompare(t.ano):e.cultivar!==t.cultivar?e.cultivar.localeCompare(t.cultivar):e.semente.localeCompare(t.semente));const L=document.getElementById("ano-select"),Ye=w.filter((e,t,n)=>t===n.findIndex(i=>i.ano===e.ano)),ze=Ye.map((e,t)=>({id:t+1,ano:e.ano}));q(ze,L,"ano");const C=document.getElementById("cultivar-select"),Ue=w.filter((e,t,n)=>t===n.findIndex(i=>i.cultivar===e.cultivar)),Ge=Ue.map((e,t)=>({id:t+1,cultivar:e.cultivar}));q(Ge,C,"cultivar");const x=document.getElementById("embalagem-select"),He=w.filter((e,t,n)=>t===n.findIndex(i=>i.embalagem===e.embalagem)),Qe=He.map((e,t)=>({id:t+1,embalagem:e.embalagem}));q(Qe,x,"embalagem");let Z=document.getElementById("container-cultivares-select");function Je(){Z.classList.remove("hidden"),document.getElementById("header-index").classList.add("hidden")}const We=document.getElementById("icone-filtro");We.addEventListener("click",Je);function Xe(){Z.classList.add("hidden"),document.getElementById("header-index").classList.remove("hidden")}const Ze=document.getElementById("icone-fechar-filtro");Ze.addEventListener("click",Xe);let et=[L,C,x];et.forEach(e=>{e.addEventListener("change",tt)});let ee=document.getElementById("container-cartoes"),S=document.getElementById("container-novos-cartoes");async function tt(){S.innerHTML="",ee.remove(),S.classList.add("index-mudasbd"),console.log("selectFiltrarAno.value",L.value,"selectFiltrarCultivar",C.value,"selectFiltrarEmbalagem",x.value);let e=w;const t=L.value,n=C.value,i=x.value,a=e.filter(o=>(!t||o.ano===t)&&(!n||o.cultivar===n)&&(!i||o.embalagem===i));a.sort((o,l)=>o.ano!==l.ano?o.ano.localeCompare(l.ano):o.cultivar!==l.cultivar?o.cultivar.localeCompare(l.cultivar):o.semente.localeCompare(l.semente)),te(a,S)}function rt(e){const t=e.reduce((n,i)=>{const a=i.idmuda,o=le(i.pedido);return n[a]||(n[a]={idmuda:a,pedido:0}),n[a].pedido+=o,n},{});return Object.values(t)}let ot=rt(Ke);async function te(e,t){t.innerHTML="";let n=0,i=0,a=0;for(const o of await e){o.pedido=0;let l=ot.find(N=>Number(N.idmuda)===Number(o.id));o.pedido=l?l.pedido:0;let f=o.producao-o.pedido;const _=`
          <div class="card-produto" data-tipo=${o.embalagem.toLowerCase()}>
            <p class="cultivar">${o.cultivar}</p>

  <p class="embalagem">${o.embalagem}</p>
            <p class="producao">Produção: ${Number(o.producao).toLocaleString("pt-BR")}</p>
            <p class="pedido">Pedido: ${Number(o.pedido).toLocaleString("pt-BR")} </p>
            <p class="estoque">Estoque: ${Number(f).toLocaleString("pt-BR")} </p>
            <button id="adicionar-${o.id}" ><i class="fa-solid fa-cart-plus"></i></button>
          </div>`;t.innerHTML+=_,n+=Number(o.producao),i+=Number(o.pedido),a+=f}document.getElementById("container-produto-soma").innerHTML=`PRODUÇÃO:
        ${Number(n).toLocaleString("pt-BR")}`,document.getElementById("container-produto-pedido").innerHTML=`PEDIDO:
        ${Number(i).toLocaleString("pt-BR")}`,document.getElementById("container-produto-estoque").innerHTML=`ESTOQUE:
        ${Number(a).toLocaleString("pt-BR")}`;for(const o of e)document.getElementById(`adicionar-${o.id}`).addEventListener("click",()=>{je(o.id)})}te(P,ee);Ae();
