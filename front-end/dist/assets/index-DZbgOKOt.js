(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const o of r)if(o.type==="childList")for(const i of o.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&n(i)}).observe(document,{childList:!0,subtree:!0});function a(r){const o={};return r.integrity&&(o.integrity=r.integrity),r.referrerPolicy&&(o.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?o.credentials="include":r.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(r){if(r.ep)return;r.ep=!0;const o=a(r);fetch(r.href,o)}})();function I(e,t,a){let n=Array.from(new Map(e.map(r=>[r[a],r])).values());n.sort((r,o)=>r[a].localeCompare(o[a]));for(const r of n){const o=document.createElement("option");o.id=r.id,o.value=r[a],o.textContent=r[a],t.appendChild(o)}}function D(e){return Number(e.trim().replace(/\./g,""))||0}function g(e){let t=e.value;t=t.replace(",",".");const a=parseFloat(t);isNaN(a)?e.value="":e.value=a.toFixed(2)}const A=window.location.hostname==="localhost"?"http://localhost:3000/api":"https://viveirolimeiragit.onrender.com/api";async function P(){try{const e=await fetch(`${A}/mudas`);if(!e.ok)throw new Error("Erro ao buscar mudas");return await e.json()}catch(e){return console.error("Erro ao buscar mudas:",e),[]}}let y=await P();y.sort((e,t)=>e.cultivar.localeCompare(t.cultivar));const O=window.location.hostname==="localhost"?"http://localhost:3000/api":"https://viveirolimeiragit.onrender.com/api";async function k(){try{const e=await fetch(`${O}/pedidos`);if(!e.ok)throw new Error("Erro ao buscar pedidos");return await e.json()}catch(e){return console.error("Erro ao buscar pedidos:",e),[]}}const M=window.location.hostname==="localhost"?"http://localhost:3000/api":"https://viveirolimeiragit.onrender.com/api";async function H(e,t,a,n,r,o,i,l,u,m,c){const d={id:e,idPedido:t,ano:a,cultivar:n,semente:r,embalagem:o,precoMuda:i,desconto:l,precoMudaDesconto:u,pedido:m,precoMudaTotal:c},p=await fetch(`${M}/carrinho`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(d)});try{if(!p.ok)throw alert("Erro de resposta"),new Error("Erro de resposta");p.ok?alert("Carrinho adicionado!!!!"):alert("Erro ao adicionar carrinho!!!!")}catch{alert("Erro ao adicionar carrinho, catch!!!!")}}async function z(){try{const e=await fetch(`${M}/carrinho`,{method:"DELETE"});if(!e.ok){const t=await e.json();alert("Erro ao excluir carrinho: "+t.message)}}catch(e){console.error(e),alert("Erro de conexão com o servidor.")}}let s={},C=[];const L=document.getElementById("index-produto-total"),B=document.getElementById("index-valor-total");function U(){document.getElementById("carrinho").style.right="0rem"}function j(){document.getElementById("carrinho").style.right="-40rem"}function Q(){const e=document.getElementById("fechar-carrinho"),t=document.getElementById("abrir-carrinho");e.addEventListener("click",j),t.addEventListener("click",U)}function V(e){delete s[e];for(const t in s)x(t);_()}function T(e){e||(s[e]="");let t=y.find(d=>d.id===e);delete t.estoque,delete t.producao,C.push(t);const a=document.getElementById("produtos-carrinho"),n=document.createElement("article");n.classList.add("cartao-produto-carrinho");const r=`
      <i id="remover-produto-${t.id}" class="fechar-produto-carrinho fa-solid fa-circle-xmark"></i>
      <div class="container-article-carrinho">
      <div class="cultivar-embalagem-carrinho">
        <p id="cultivar-${t.id}" class="cultivar-carrinho">${t.cultivar}</p>
        <p id="embalagem-${t.id}" class="embalagem-carrinho">${t.embalagem}</p>
      </div>

      <div class="valor-adicionar-carrinho">
      <div>
        <label for="valor-muda-${t.id}">R$_muda</label>
        <input type="text" id="valor-muda-${t.id}" class="input-produto-carrinho valor-muda" placeholder="R$ 0,00">
        </div>

      <div>
        <label for="desconto-muda-${t.id}">Desconto (%)</label>
        <input type="text" id="desconto-muda-${t.id}" class="input-produto-carrinho desconto-muda" placeholder="0,00">
      </div>

      <div>
        <label for="valor-muda-desconto-${t.id}">Desconto (R$_muda)</label>
        <input type="text" id="valor-muda-desconto-${t.id}" class="input-produto-carrinho valor-muda-desconto" placeholder="R$ 0,00">
        </div>

      </div>

      <div class="qtde-adicionar-carrinho">
          <div>
            <label for="quantidade-${t.id}">Qtde mudas</label>
            <input type="text" id="quantidade-${t.id}" class="input-produto-carrinho" placeholder="0.0">
          </div>

          <div>
            <label for="valor-total-${t.id}">R$ total</label>
            <input type="text" id="valor-total-${t.id}" class="input-produto-carrinho" placeholder="R$ 0,00">
          </div>

          <div>
            <button id="adicionar-${t.id}" class="adicionar-produto-carrinho">Adicionar</button>
          </div>

      </div>
      </div>`;n.innerHTML=r,a.appendChild(n),document.getElementById("index-finalizar-compra").classList.remove("hidden");let i=document.getElementById(`valor-muda-${t.id}`),l=document.getElementById(`desconto-muda-${t.id}`),u=document.getElementById(`valor-muda-desconto-${t.id}`),m=document.getElementById(`valor-total-${t.id}`),c=document.getElementById(`quantidade-${t.id}`);i.addEventListener("blur",()=>{if(g(i),g(l),l.value.length===0){if(u.value=i.value,c.value.length>0){let d=c.value.replace(/\D/g,"");d=Number(d),m.value=(Number(i.value)*d).toLocaleString("pt-BR")}return}if(l.value.length>0&&(u.value=(i.value*((100-l.value)/100)).toFixed(2),c.value.length>0)){let d=c.value.replace(/\D/g,"");d=Number(d),m.value=(Number(u.value)*d).toLocaleString("pt-BR")}}),l.addEventListener("blur",()=>{if(g(i),g(l),i.value.length>0&&(u.value=(i.value*((100-l.value)/100)).toFixed(2),c.value.length>0)){let d=c.value.replace(/\D/g,"");d=Number(d),m.value=(Number(u.value)*d).toLocaleString("pt-BR")}}),c.addEventListener("input",()=>{let d=c.value.replace(/\D/g,"");d=Number(d).toLocaleString("pt-BR"),c.value=d}),c.addEventListener("blur",()=>{let d=c.value.replace(/\D/g,"");d=Number(d),m.value=(Number(u.value)*d).toLocaleString("pt-BR")}),document.getElementById(`remover-produto-${t.id}`).addEventListener("click",()=>{V(t.id)}),document.getElementById(`quantidade-${t.id}`).addEventListener("input",d=>{s[e]=d.target.value;let p=C.find(w=>w.id===t.id);p&&(p.pedido=d.target.value)}),document.getElementById(`adicionar-${t.id}`).addEventListener("click",()=>{x(t.id)})}function _(){const e=document.getElementById("produtos-carrinho");e.innerHTML="";for(const t in s)console.log("idProduto",t),T(t),document.getElementById(`quantidade-${t}`).value=s[t]}function J(e){e in s||(s[e]=0,T(e))}L.classList.add("hidden");B.classList.add("hidden");function x(e){s[e]=document.getElementById(`quantidade-${e}`).value.replace(".","");const t=parseFloat(document.getElementById(`valor-muda-${e}`).value),a=parseFloat(document.getElementById(`desconto-muda-${e}`).value),n=parseFloat(document.getElementById(`quantidade-${e}`).value);(isNaN(t)||isNaN(a)||isNaN(n)||t<0||a<0||n<0||t===0||a===0||n===0)&&alert("Por favor, digite corretamente a quantidade de mudas!!!");let r=[],o=[];for(const i in s){let l=Number(s[i]).toFixed(0);r.push(Number(l)),o.push(Number(Number(s[i]))*document.getElementById(`valor-muda-desconto-${i}`).value)}L.classList.remove("hidden"),L.innerText=`Mudas total: ${r.reduce((i,l)=>i+l,0).toLocaleString("pt-BR")}`,B.classList.remove("hidden"),B.innerText=`Valor total: R$ ${o.reduce((i,l)=>i+l,0).toLocaleString("pt-BR")}`}document.getElementById("index-finalizar-compra").addEventListener("click",async()=>{await z();let e={id:"",idPedido:"",ano:"",semente:"",embalagem:"",cultivar:"",precoMuda:"",desconto:"",precoMudaDesconto:"",pedido:"",precoMudaTotal:""},t=await y;for(const a in s){e={};let n=document.getElementById(`quantidade-${a}`).value,r=t.filter(o=>String(o.id)===String(a));e.id=r[0].id,e.idPedido=`${r[0].idmuda}-${n}`,e.ano=r[0].ano,e.cultivar=r[0].cultivar,e.semente=r[0].semente,e.embalagem=r[0].embalagem,e.cultivar=r[0].cultivar,e.precoMuda=document.getElementById(`valor-muda-${a}`).value,e.desconto=document.getElementById(`desconto-muda-${a}`).value,e.precoMudaDesconto=document.getElementById(`valor-muda-desconto-${a}`).value,e.pedido=document.getElementById(`quantidade-${a}`).value,e.precoMudaTotal=document.getElementById(`valor-total-${a}`).value,H(e.id,e.idPedido,e.ano,e.cultivar,e.semente,e.embalagem,e.precoMuda,e.desconto,e.precoMudaDesconto,e.pedido,e.precoMudaTotal)}window.location.href="checkout.html"});let v=await P()??[],K=await k()??[];v.sort((e,t)=>e.ano!==t.ano?e.ano.localeCompare(t.ano):e.cultivar!==t.cultivar?e.cultivar.localeCompare(t.cultivar):e.semente.localeCompare(t.semente));const h=document.getElementById("ano-select"),G=v.filter((e,t,a)=>t===a.findIndex(n=>n.ano===e.ano)),W=G.map((e,t)=>({id:t+1,ano:e.ano}));I(W,h,"ano");const f=document.getElementById("cultivar-select"),X=v.filter((e,t,a)=>t===a.findIndex(n=>n.cultivar===e.cultivar)),Y=X.map((e,t)=>({id:t+1,cultivar:e.cultivar}));I(Y,f,"cultivar");const E=document.getElementById("embalagem-select"),Z=v.filter((e,t,a)=>t===a.findIndex(n=>n.embalagem===e.embalagem)),ee=Z.map((e,t)=>({id:t+1,embalagem:e.embalagem}));I(ee,E,"embalagem");let S=document.getElementById("container-cultivares-select");function te(){S.classList.remove("hidden"),document.getElementById("header-index").classList.add("hidden")}const oe=document.getElementById("icone-filtro");oe.addEventListener("click",te);function ae(){S.classList.add("hidden"),document.getElementById("header-index").classList.remove("hidden")}const re=document.getElementById("icone-fechar-filtro");re.addEventListener("click",ae);let ne=[h,f,E];ne.forEach(e=>{e.addEventListener("change",ie)});let F=document.getElementById("container-cartoes"),b=document.getElementById("container-novos-cartoes");async function ie(){b.innerHTML="",F.remove(),b.classList.add("index-mudasbd"),console.log("selectFiltrarAno.value",h.value,"selectFiltrarCultivar",f.value,"selectFiltrarEmbalagem",E.value);let e=v;const t=h.value,a=f.value,n=E.value,r=e.filter(o=>(!t||o.ano===t)&&(!a||o.cultivar===a)&&(!n||o.embalagem===n));r.sort((o,i)=>o.ano!==i.ano?o.ano.localeCompare(i.ano):o.cultivar!==i.cultivar?o.cultivar.localeCompare(i.cultivar):o.semente.localeCompare(i.semente)),R(r,b)}function de(e){const t=e.reduce((a,n)=>{const r=n.idmuda,o=D(n.pedido);return a[r]||(a[r]={idmuda:r,pedido:0}),a[r].pedido+=o,a},{});return Object.values(t)}let le=de(K);async function R(e,t){t.innerHTML="";let a=0,n=0,r=0;for(const o of await e){o.pedido=0;let i=le.find(m=>Number(m.idmuda)===Number(o.id));o.pedido=i?i.pedido:0;let l=o.producao-o.pedido;const u=`
          <div class="card-produto" data-tipo=${o.embalagem.toLowerCase()}>
            <p class="cultivar">${o.cultivar}</p>

  <p class="embalagem">${o.embalagem}</p>
            <p class="producao">Produção: ${Number(o.producao).toLocaleString("pt-BR")}</p>
            <p class="pedido">Pedido: ${Number(o.pedido).toLocaleString("pt-BR")} </p>
            <p class="estoque">Estoque: ${Number(l).toLocaleString("pt-BR")} </p>
            <button id="adicionar-${o.id}" ><i class="fa-solid fa-cart-plus"></i></button>
          </div>`;t.innerHTML+=u,a+=Number(o.producao),n+=Number(o.pedido),r+=l}document.getElementById("container-produto-soma").innerHTML=`PRODUÇÃO:
        ${Number(a).toLocaleString("pt-BR")}`,document.getElementById("container-produto-pedido").innerHTML=`PEDIDO:
        ${Number(n).toLocaleString("pt-BR")}`,document.getElementById("container-produto-estoque").innerHTML=`ESTOQUE:
        ${Number(r).toLocaleString("pt-BR")}`;for(const o of e)document.getElementById(`adicionar-${o.id}`).addEventListener("click",()=>{J(o.id)})}const N={"/":"src/pages/clientes.html","/clientes":"src/pages/clientes.html","/mudas":"src/pages/mudas.html","/pedidos":"src/pages/pedidos.html"};function ce(){document.querySelectorAll("a[data-route]").forEach(e=>{e.addEventListener("click",t=>{t.preventDefault();const a=e.getAttribute("href");se(a)})}),window.addEventListener("popstate",()=>{$(window.location.pathname)}),$(window.location.pathname)}function se(e){window.history.pushState({},"",e),$(e)}async function $(e){const t=N[e]||N["/"];try{const n=await(await fetch(t)).text();document.getElementById("conteudo-principal").innerHTML=n}catch(a){console.error("Erro ao carregar página:",a),document.getElementById("conteudo-principal").innerHTML="<h2>Erro ao carregar a página</h2>"}}ce();R(y,F);Q();document.getElementById("link-mudas").addEventListener("click",e=>{e.preventDefault(),window.history.pushState({},"","/mudas"),q("src/pages/mudas.html")});async function q(e){try{const a=await(await fetch(e)).text();document.getElementById("conteudo-principal").innerHTML=a}catch(t){console.error("Erro ao carregar a página:",t),document.getElementById("conteudo-principal").innerHTML="<p>Erro ao carregar conteúdo.</p>"}}window.addEventListener("popstate",()=>{window.location.pathname==="/mudas"&&q("src/pages/mudas.html")});
